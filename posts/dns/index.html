<!doctype html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>DNS - Tomial's Blog</title><meta name=viewport content="width=device-width,initial-scale=1">
<meta property="og:image" content><meta property="og:title" content="DNS"><meta property="og:description" content="关于域名系统(Domain Name System)的笔记"><meta property="og:type" content="article"><meta property="og:url" content="https://tomial.github.io/posts/dns/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-02-02T13:54:56+08:00"><meta property="article:modified_time" content="2024-02-02T13:54:56+08:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="DNS"><meta name=twitter:description content="关于域名系统(Domain Name System)的笔记"><script src=https://tomial.github.io/js/feather.min.js></script><link href=https://tomial.github.io/css/fonts.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://tomial.github.io/css/main.css><link rel=stylesheet type=text/css href=https://tomial.github.io/css/dark.css></head><body><div class=content><header><div class=main><a href=https://tomial.github.io/>Tomial's Blog</a></div><nav><a href=/>主页</a>
<a href=/posts>全部文章</a>
<a href=/tags>标签</a>
<a href=/about>关于</a></nav></header><main><article><div class=title><h1 class=title>DNS</h1><div class=meta style=margin-bottom:3em>最后编辑于 2024-02-02</div></div><section class=body><p>关于域名系统(Domain Name System)的笔记</p><h2 id=dns的定义>DNS的定义</h2><p>DNS是<strong>Domain Name System</strong>的缩写，其本质上是一组分布式服务器，提供将域名和IP地址转换的服务</p><p>一般DNS使用UDP协议，但同时也支持TCP，有时域名会发送大于512KB的响应，此时会用到TCP连接；在进行Zone Transfer时也会用到TCP，这属于DNS服务器管理的问题，与一般用户无关。</p><p>值得注意的是，DNS属于应用层的服务，DNS查询的调用(<code>getaddrinfo(3)</code>)位于libc中，不是系统调用，内核中实现的TCP/IP协议栈完全不关心域名，只关心IP地址和端口等</p><h2 id=dns的一般查询>DNS的一般查询</h2><p>一般的主机DNS查询将<code>example.com</code>转换为IP地址的过程如下：</p><ul><li>先检查本地的DNS缓存有没有需要的结果，没有则请求resolver（解析服务器），一般是主机配置的DNS服务器，例如<code>1.1.1.1</code></li><li>resolver检查自己的缓存有没有该域名的记录，若有则返回，此时若返回为<strong>非权威记录</strong>，因为是在缓存里找到的（缓存有过期风险），而不是权威服务器返回的（递归请求）</li><li>如果resolver缓存没有该记录，则会像根服务器（Root Server）请求，根服务器IP的数量是固定的，目前为13个（2024年2月），它会将resolver请求重定向到顶级域服务器。</li></ul><blockquote><p>一个普遍的误解是，世界上只有 13 台根服务器。实际上根服务器有许多，但只有 13 个 IP 地址用于查询不同的根服务器网络。DNS 原始架构的限制要求根区域中最多只能有 13 个服务器地址。在 Internet 面世之初，这 13 个 IP 地址的每一个都只有一台服务器，其中大多数位于美国。</p><p>如今，这 13 个 IP 地址中的每一个都有多个服务器，这些服务器使用 Anycast 路由基于负荷和距离分发请求。目前，地球上每座有人生活的大陆上都分布着 600 多台 DNS 根服务器。</p></blockquote><ul><li>根服务器将resolver的请求重定向到顶级域服务器(TLD Server)，这个例子是<code>.com</code>，顶级域服务器管理该顶级域下的所有内容，它再将resolver的请求重定向到权威服务器。</li><li>权威服务器中包含该域所有的域名的记录，这里获取的记录为<strong>权威记录</strong>，在这里可以获得该域名的IP地址（A记录）</li><li>resolver将获取到的IP地址返回给主机</li></ul><p><img src=/images/dns/dns-lookup.png alt=resolver></p><h2 id=域名层级>域名层级</h2><p>域名层级可以看成是反向的Unix文件目录，例如<code>www.example.com</code>可以看成<code>/com/example/www</code>：
<img src=/images/dns/hierarchy.gif alt=hierarchy></p><p><img src=/images/dns/dns-schema.svg.png alt=hierarchy-2>
以<code>.</code>结尾的域名称为FQDN(fully qualified domain name)，也称为绝对域名（absolute domain name）。绝对域名可以在树状图中指示唯一的位置，一般在DNS服务器中使用，日常使用不会碰到；没有以<code>.</code>结尾的域名会自动补全。例如，<code>www.example.com</code>补全后是<code>www.example.com.</code>，可以分成几部分：</p><p><img src=/images/dns/examplecom.png alt=example.com></p><p>分别是子域名(www)，二级域名(example)，顶级域名(.com)和根域名(.)</p><h2 id=域名记录类型>域名记录类型</h2><p>上面提到域名可以分为多个层级，有时我们会碰到<code>www.example.com</code>和<code>example.com</code>都可以进去同一个网站的情况，这是为什么呢？
前文提到DNS查询返回的是<strong>A记录</strong>，DNS服务器中的类型有很多种，最常见的是A记录（还有<strong>AAAA记录</strong>用于查询IPv6的结果），包含了域名和IP地址：</p><table><thead><tr><th>example.com</th><th>record type</th><th>value</th><th>TTL</th></tr></thead><tbody><tr><td>@(@表示这是根域的记录)</td><td>A</td><td>192.0.2.1</td><td>14400</td></tr></tbody></table><p>还有<strong>CNAME记录（canonical name）</strong>，用于给域名取别名，<code>www.example.com</code>和<code>example.com</code>指向同一个记录就是使用了CNAME记录：</p><table><thead><tr><th>blog.example.com</th><th>record type</th><th>value</th><th>TTL</th></tr></thead><tbody><tr><td>@</td><td>CNAME</td><td>is an alias of <a href=https://www.example.com>www.example.com</a></td><td>32600</td></tr></tbody></table><table><thead><tr><th><a href=https://www.example.com>www.example.com</a></th><th>record type</th><th>value</th><th>TTL</th></tr></thead><tbody><tr><td>@</td><td>CNAME</td><td>is an alias of example.com</td><td>32600</td></tr></tbody></table><p><strong>NS记录（name server记录）</strong> 表示哪个服务器对该域名具有权威性，用于指示权威服务器或辅助服务器。</p><table><thead><tr><th>example.com</th><th>record type</th><th>value</th><th>TTL</th></tr></thead><tbody><tr><td>@</td><td>NS</td><td>ns1.exampleserver.com</td><td>32600</td></tr></tbody></table><p><strong>SRV记录（service记录）</strong> 类似A记录，但是它还包含了端口的内容，用于给特定服务指定域名
SRV 记录必须指向一个 A 记录或一个 AAAA 记录。它们列出的服务器名称不能是CNAME</p><p><strong>PTR记录（pointer记录）</strong> 指针记录用于<strong>反向DNS查找</strong>，即提供IP地址，查询是否存在对应的域名。
查询邮件发送方IP对应的域名是否为邮件发送方声称的域名，可以用于邮箱的垃圾邮件检测</p><p><strong>MX记录（main exchange记录）</strong> 用于获取邮箱子域名</p><table><thead><tr><th>example.com</th><th>record type</th><th>value</th><th>TTL</th></tr></thead><tbody><tr><td>@</td><td>MX</td><td>10</td><td>mailhost1.example.com</td></tr><tr><td>@</td><td>MX</td><td>20</td><td>mailhost2.example.com</td></tr></tbody></table></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/network>network</a></li></ul></nav></div></article></main><footer><hr><a class=soc href=https://github.com/tomial title=Github><i data-feather=github></i></a>|⚡️
2024 © Tomial | Modified <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></footer><script>feather.replace()</script></div></body></html>