<!doctype html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>为什么Java中数组是协变的而泛型不是? - Tomial's Blog</title><meta name=viewport content="width=device-width,initial-scale=1">
<meta property="og:image" content><meta property="og:title" content="为什么Java中数组是协变的而泛型不是?"><meta property="og:description" content="什么是协变? Effective Java中写到： 1.数组和泛型有两个主要的不同点。第一个是数组是协变的(covariant)，而泛型是不变的(invarian"><meta property="og:type" content="article"><meta property="og:url" content="https://tomial.github.io/posts/%E4%B8%BA%E4%BB%80%E4%B9%88java%E4%B8%AD%E6%95%B0%E7%BB%84%E6%98%AF%E5%8D%8F%E5%8F%98%E7%9A%84%E8%80%8C%E6%B3%9B%E5%9E%8B%E4%B8%8D%E6%98%AF/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2019-08-10T18:15:14+00:00"><meta property="article:modified_time" content="2019-08-10T18:15:14+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="为什么Java中数组是协变的而泛型不是?"><meta name=twitter:description content="什么是协变? Effective Java中写到： 1.数组和泛型有两个主要的不同点。第一个是数组是协变的(covariant)，而泛型是不变的(invarian"><script src=https://tomial.github.io/js/feather.min.js></script><link href=https://tomial.github.io/css/fonts.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://tomial.github.io/css/main.css><link rel=stylesheet type=text/css href=https://tomial.github.io/css/dark.css></head><body><div class=content><header><div class=main><a href=https://tomial.github.io/>Tomial's Blog</a></div><nav><a href=/>主页</a>
<a href=/posts>全部文章</a>
<a href=/tags>标签</a>
<a href=/about>关于</a></nav></header><main><article><div class=title><h1 class=title>为什么Java中数组是协变的而泛型不是?</h1><div class=meta style=margin-bottom:3em>最后编辑于 2019-08-10</div></div><section class=body><h3 id=什么是协变>什么是协变?</h3><p>Effective Java中写到：</p><p>1.数组和泛型有两个主要的不同点。第一个是数组是协变的(covariant)，而泛型是不变的(invariant)。</p><p>2.协变简单来说就是如果<code>X</code>是<code>Y</code>的子类型则<code>X[]</code>也是 <code>Y[]</code>的子类型。因为数组是协变的，<code>String</code>是<code>Object</code>的子类型，故：</p><p><code>String[] 是Object[]的子类型</code></p><p>不变的(invariant)简单来说就是无论<code>X</code>是不是<code>Y</code>的子类型，</p><p><code>List&lt;X> 都不会是 List&lt;Y>的子类型</code></p><h3 id=原因>原因：</h3><blockquote><p>早期的Java和C#都没有泛型的特性(参数多态)</p><p>这种情况下，假设要写一个打乱数组功能的函数，或者一个测试数组元素是否相等的<code>Object.equals</code>方法，实现就不能只针对单一的类型，所以如果要写一个通用的函数，可以用以下的写法：</p><p><code>boolean equalArrays(Object[] a1, Object[] a2);</code></p><p><code>void shuffleArray(Object[] a);</code></p><p>上面提到，假设数组是不变的(invariant)，那么<code>String[]</code>不是<code>Object[]</code>的子类型，那么只能给这两个函数传<code>Object[]</code>类型的数组参数，所以设计者们将数组设计为协变的(covariant)，便可以将<code>String[]</code>、<code>Integer[]</code>等类型传进去，这两个函数就可以通用于各种类型。</p></blockquote><p>上面就是“为什么Java中数组是协变的”的原因。</p><p>当泛型出现后，设计者有目的性地将泛型设计为不变的(invariant)</p><p>Jon Skeet:</p><blockquote><p><code>List&lt;Dog></code>跟<code>List&lt;Animal></code>不是一个东西。想想你会怎么使用<code>List&lt;Animal></code>&mldr;你可以向里面添加各种动物，包括一只猫。逻辑上你没法往一群小狗里面加一只猫：</p></blockquote><div class=highlight><div style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span> <span style=color:#776e71>// Illegal code - because otherwise life would be Bad</span>
</span></span><span style=display:flex><span> List<span style=color:#5bc4bf>&lt;</span>Dog<span style=color:#5bc4bf>&gt;</span> dogs <span style=color:#5bc4bf>=</span> <span style=color:#815ba4>new</span> List<span style=color:#5bc4bf>&lt;</span>Dog<span style=color:#5bc4bf>&gt;</span>();
</span></span><span style=display:flex><span> List<span style=color:#5bc4bf>&lt;</span>Animal<span style=color:#5bc4bf>&gt;</span> animals <span style=color:#5bc4bf>=</span> dogs; <span style=color:#776e71>// Awooga awooga</span>
</span></span><span style=display:flex><span> animals.<span style=color:#06b6ef>add</span>(<span style=color:#815ba4>new</span> Cat());
</span></span><span style=display:flex><span> Dog dog <span style=color:#5bc4bf>=</span> dogs.<span style=color:#06b6ef>get</span>(0); <span style=color:#776e71>// This should be safe, right?</span>
</span></span></code></pre></td></tr></table></div></div><p>`之所以没有像数组一样将泛型设计为协变的是因为**通配符(wildcards)**让协变表达式变得可能</p><div class=highlight><div style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#fec418>boolean</span> <span style=color:#06b6ef>equalLists</span>(List<span style=color:#5bc4bf>&lt;?&gt;</span> l1, List<span style=color:#5bc4bf>&lt;?&gt;</span> l2);
</span></span><span style=display:flex><span><span style=color:#fec418>void</span> <span style=color:#06b6ef>shuffleList</span>(List<span style=color:#5bc4bf>&lt;?&gt;</span> l);
</span></span></code></pre></td></tr></table></div></div><p>参考资料：</p><p><a href=https://stackoverflow.com/questions/18666710/why-are-arrays-covariant-but-generics-are-invariant>Why are arrays covariant but generics are invariant?&ndash;StackOverflow</a></p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/java>Java</a></li></ul></nav></div></article></main><footer><hr><a class=soc href=https://github.com/tomial title=Github><i data-feather=github></i></a>|⚡️
2024 © Tomial | Modified <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></footer><script>feather.replace()</script></div></body></html>