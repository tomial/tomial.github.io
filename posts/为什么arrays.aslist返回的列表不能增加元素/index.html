<!doctype html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><title>为什么Arrays.asList()返回的列表不能增加元素 - Tomial's Blog</title><meta name=viewport content="width=device-width,initial-scale=1">
<meta property="og:image" content><meta property="og:title" content="为什么Arrays.asList()返回的列表不能增加元素"><meta property="og:description" content="1 2 3 String[] arr = {&#34;A&#34;, &#34;B&#34;}; List<String> list = Arrays.asList(arr); list.add(&#34;C&#34;); //java.lang.UnsupportedOperationException 如果调用Arrays.asList()方法返回列表的add方法会抛出异常，这是什么原因呢？ 在asList方法源码"><meta property="og:type" content="article"><meta property="og:url" content="https://tomial.github.io/posts/%E4%B8%BA%E4%BB%80%E4%B9%88arrays.aslist%E8%BF%94%E5%9B%9E%E7%9A%84%E5%88%97%E8%A1%A8%E4%B8%8D%E8%83%BD%E5%A2%9E%E5%8A%A0%E5%85%83%E7%B4%A0/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2020-04-10T17:49:32+00:00"><meta property="article:modified_time" content="2020-04-10T17:49:32+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="为什么Arrays.asList()返回的列表不能增加元素"><meta name=twitter:description content="1 2 3 String[] arr = {&#34;A&#34;, &#34;B&#34;}; List<String> list = Arrays.asList(arr); list.add(&#34;C&#34;); //java.lang.UnsupportedOperationException 如果调用Arrays.asList()方法返回列表的add方法会抛出异常，这是什么原因呢？ 在asList方法源码"><script src=https://tomial.github.io/js/feather.min.js></script><link href=https://tomial.github.io/css/fonts.css rel=stylesheet><link rel=stylesheet type=text/css media=screen href=https://tomial.github.io/css/main.css><link rel=stylesheet type=text/css href=https://tomial.github.io/css/dark.css></head><body><div class=content><header><div class=main><a href=https://tomial.github.io/>Tomial's Blog</a></div><nav><a href=/>主页</a>
<a href=/posts>全部文章</a>
<a href=/tags>标签</a>
<a href=/about>关于</a></nav></header><main><article><div class=title><h1 class=title>为什么Arrays.asList()返回的列表不能增加元素</h1><div class=meta style=margin-bottom:3em>最后编辑于 2020-04-10</div></div><section class=body><div class=highlight><div style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span>String<span style=color:#5bc4bf>[]</span> arr <span style=color:#5bc4bf>=</span> {<span style=color:#48b685>&#34;A&#34;</span>, <span style=color:#48b685>&#34;B&#34;</span>};
</span></span><span style=display:flex><span>List<span style=color:#5bc4bf>&lt;</span>String<span style=color:#5bc4bf>&gt;</span> list <span style=color:#5bc4bf>=</span> Arrays.<span style=color:#06b6ef>asList</span>(arr);
</span></span><span style=display:flex><span>list.<span style=color:#06b6ef>add</span>(<span style=color:#48b685>&#34;C&#34;</span>);	<span style=color:#776e71>//java.lang.UnsupportedOperationException</span>
</span></span></code></pre></td></tr></table></div></div><p>如果调用<code>Arrays.asList()</code>方法返回列表的add方法会抛出异常，这是什么原因呢？</p><p>在<code>asList</code>方法源码可以看到</p><div class=highlight><div style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#815ba4>public</span> <span style=color:#815ba4>static</span> <span style=color:#5bc4bf>&lt;</span>T<span style=color:#5bc4bf>&gt;</span> List<span style=color:#5bc4bf>&lt;</span>T<span style=color:#5bc4bf>&gt;</span> <span style=color:#06b6ef>asList</span>(T... a) {
</span></span><span style=display:flex><span>    <span style=color:#815ba4>return</span> <span style=color:#815ba4>new</span> ArrayList<span style=color:#5bc4bf>&lt;&gt;</span>(a);
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>返回的是一个<code>ArrayList</code>列表，然而这个<code>ArrayList</code>跟常用的<code>java.util.ArrayList</code>并不是同一个东西</p><p><img src=/images/Arrays-ArrayList.png alt=java.util.Arrays.ArrayList></p><p><img src=/images/util-ArrayList.png alt=java.util.ArrayList></p><p>也就是说<code>Arrays.asList()</code>返回的并不是可扩容的那个<code>ArrayList</code>，而是在<code>Arrays</code>类内部写的另一个<code>ArrayList</code>，可以看到这两个<code>ArrayList</code>都继承了<code>AbstractList&lt;T></code>接口。</p><p>跳转到<code>AbstractList&lt;T></code>接口的<code>add()</code>方法定义处可以看到</p><div class=highlight><div style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#e7e9db;background-color:#2f1e2e;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-java data-lang=java><span style=display:flex><span> <span style=color:#815ba4>public</span> <span style=color:#fec418>void</span> <span style=color:#06b6ef>add</span>(<span style=color:#fec418>int</span> index, E element) {
</span></span><span style=display:flex><span>     <span style=color:#815ba4>throw</span> <span style=color:#815ba4>new</span> UnsupportedOperationException();
</span></span><span style=display:flex><span> }
</span></span></code></pre></td></tr></table></div></div><p>默认就是不支持<code>add</code>操作的。</p><p>而上面的注释也写到：</p><pre tabindex=0><code>Note that this implementation throws an UnsupportedOperationException unless {add(int, Object) add(int, E)} is overridden.
// 除非add操作被重写否则不支持add操作
</code></pre><p>而因为<code>java.util.ArrayList</code>重写了add方法，<code>java.util.Arrays.ArrayList</code>没有重写，所以<code>Arrays.asList()</code>返回的列表不支持该操作。</p><p>参考链接：</p><p><a href=https://www.jianshu.com/p/2b113f487e5e>Arrays.asList使用指南-简书</a></p></section><div class=post-tags><nav class="nav tags"><ul class=tags><li><a href=/tags/java>Java</a></li></ul></nav></div></article></main><footer><hr><a class=soc href=https://github.com/tomial title=Github><i data-feather=github></i></a>|⚡️
2024 © Tomial | Modified <a href=https://github.com/athul/archie>Archie Theme</a> | Built with <a href=https://gohugo.io>Hugo</a></footer><script>feather.replace()</script></div></body></html>